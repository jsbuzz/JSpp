var Class=function(e){if(typeof e=="function"){Class._provideBasicFunctions(e,true);return e}else if(typeof e=="object"&&typeof e.length=="number"){var t=function(){};t._isWrapper=e;return t}};Class._provideBasicFunctions=function(e,t,n){e.extend||(e.extend=n?Class.extend.bind(n):Class.extend);e.extendStatic||(e.extendStatic=n?Class.extendStatic.bind(n):Class.extendStatic);e._params||(e._params=Class._params);e.applyTo=Class.applyTo;if(e&&t){if(typeof e.prototype!="object")e.prototype={};e.prototype.scope=Class._scope;e.prototype.protected=Class._protected;e.prototype.abstract=Class._abstract;e.prototype.instanceOf=Class.prototype.instanceOf;e.prototype.super=Class.prototype.super}};Class._applyConstructor=function(e,t,n,r){r.prototype||(r.prototype={});for(var i in e.prototype)r.prototype[i]=e.prototype[i];var s=e.apply(t,n);for(var i in s){if(typeof s[i]!=="undefined")t[i]=s[i]}};Class._constructor=function(e,t,n,r){var i=Array.prototype.slice.call(arguments,4);var s=new Array(r.length+1);s[r.length]=i;for(var o=r.length-1;o>=0;o--)s[o]=r[o].apply(e._caller,s[r[o].parent]);e._caller._instance=new n;for(var o=0;o<t.length;o++){e._caller._instance.constructor=e._caller._constructors[o]._caller||e._caller._constructors[o];Class._applyConstructor(t[o],e._caller._instance,s[o],n)}e._caller._instance.constructor=e._caller;Class._applyConstructor(e,e._caller._instance,i,n);return e._caller._instance};Class.applyTo=function(e){var t=Array.prototype.slice.call(arguments,1),n=this._paramChannels||[],r=e.constructor||this;var i=new Array(n.length+1);i[n.length]=t;for(var s=n.length-1;s>=0;s--)i[s]=n[s].apply(null,i[n[s].parent]);for(var s=0;s<this._constructors.length;s++){e.constructor=this._constructors[s]._caller||this._constructors[s];Class._applyConstructor(this._constructors[s],e,i[s],r)}e.constructor=r;return e};Class._scope=function(e,t){var n=this;n[e]||(n[e]={});for(var r in t)n[e][r]=e[r];return n[e]};Class._protected=function(e){if(this.protected==Class._protected)this.protected=Class._protected.bind(this);for(var t in e)this.protected[t]=e[t];return this.protected};Class._abstract=function(e){if(this.abstract==Class._abstract)this.abstract=Class._abstract.bind(this);e instanceof Array||(e=Array.prototype.slice.call(arguments));for(var t in e)this[e[t]]=new Function('throw new Error("Abstract method '+e[t]+'() is not implemented!")');return this.abstract};Class._inherits=function(e,t){(t._childClasses||(t._childClasses=[])).push(e);(e._ancestors||(e._ancestors=[])).push(t);for(var n in t._static){e[n]=t[n];(e._static||(e._static={}))&&(e._static[n]=n)}};Class.prototype.super=function(){if(!this.constructor._supers)throw new Error("I have no superclass!");var e,t=false;if(typeof arguments[0]=="string"&&(e=arguments[0].split("::")).length>1){arguments[0]=e[1];if(!this.constructor._classNames||typeof (t=this.constructor._classNames[e[0]])=="undefined")throw new Error("superclass '"+e[0]+"' not found")}for(var n=0;n<this.constructor._supers.length;n++){if(t!==false)n=t;this.constructor._supers[n]._instance||(this.constructor._supers[n]._instance=new this.constructor._supers[n]);if(arguments.length){var r=arguments[0],i=Array.prototype.slice.call(arguments,1);if(typeof this.constructor._supers[n]!=="undefined"&&typeof (r=this.constructor._supers[n]._instance[r])=="function"||typeof this.constructor._supers[n]._prototype!=="undefined"&&typeof (r=this.constructor._supers[n]._prototype.prototype[r])=="function"){var s=this.constructor;this.constructor=this.constructor._supers[n];var o=r.apply(this,i);this.constructor=s;return o}}else return this.constructor._supers[n]._instance;if(t!==false)return false}return false};var instanceOf=Class.instanceOf=function(e,t){return Class.prototype.instanceOf.call(e,t)};Class.prototype.instanceOf=function(e){if(this instanceof e||this.constructor===e)return true;if(!this.constructor._constructors)return false;var t=e._constructors||[e];for(var n=0,r=0;n<this.constructor._constructors.length;n++){if(this.constructor._constructors[n]==t[r]){if(++r>=t.length)return true}else if(r)return false}return false};Class.extend=function(e,t){var n=typeof this._prototype=="undefined"?this:this._prototype;for(var r in e)n.prototype[r]=e[r];if(t){for(var r in this._childClasses)this._childClasses[r].extend(e,true)}return this};Class.extendStatic=function(e,t){for(var n in e){this[n]=e[n];if(t)(this._static||(this._static={}))&&(this._static[n]=n)}if(t){for(var n in this._childClasses){this._childClasses[n].extendStatic(e,true)}}return this};Function.prototype.derived=function(e,t){if(this._isWrapper){return e.inherits(this._isWrapper,t)}Class._provideBasicFunctions(this,true);var n=this._constructors||[this];var r=function(){};paramChannel=t?Class._paramQuery(t):Class._paramQuery.proxy.bind(this);var i=(this._paramChannels||[]).concat([paramChannel]);paramChannel.parent=i.length;var s=Class._constructor.bind(e,e,n,r,i);e._caller=s;s._supers=[this];Class._provideBasicFunctions(s,false,s);s._constructors=n.concat([e]);s._prototype=r;s._prototype.prototype=this._prototype&&this._prototype.prototype||{};s._paramChannels=i;Class._inherits(s,this);return s};Function.prototype.inherits=function(e,t){e=e||Class;if(typeof e=="object"){var n={},r=[];if(typeof e.length=="undefined"){var i=0,s=[];for(var o in e){s.push(e[o]["class"]);r.push(Class._paramQuery(e[o].params)||false);n[o]=i++}e=s}var u=this._paramChannels||[],a=[],f=r?r:Array.prototype.slice.call(arguments,1),l={};for(var i=0;i<e.length;i++){a=a.concat(typeof e[i]._constructors!="undefined"?e[i]._constructors:[e[i]]);Class._provideBasicFunctions(e[i],true);u=u.concat(e[i]._paramChannels||[]).concat([null]);if(e[i]._prototype&&e[i]._prototype.prototype)for(var c in e[i]._prototype.prototype)l[c]=e[i]._prototype.prototype[c]}var h=0;for(var i=0;i<u.length;i++){if(u[i]===null){u[i]=f[h++]||Class._paramQuery.proxy.bind(this);u[i].parent=u.length}}var p=function(){};var d=Class._constructor.bind(this,this,a,p,u);Class._provideBasicFunctions(d,false,d);this._caller=d;d._supers=e;d._classNames=n;d._constructors=a.concat([this]);d._prototype=p;d._prototype.prototype=l;d._paramChannels=u;for(var i=0;i<e.length;i++)Class._inherits(d,e[i]);return d}else if(typeof e=="function")return e.derived(this,t)};Class._paramQuery=function(query){function trim(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}if(typeof query=="function")return query;if(typeof query=="object"&&query.paramsFrom){query="("+query.paramsFrom+")=>("+query.map.join()+")"}query=trim(query).split("=>");if(query.length==1){query[1]=query[0];query[0]="()"}else if(!trim(query[0]).length)query[0]="()";query[1]=trim(query[1]);return eval("(function"+query[0]+"{return ["+query[1].substring(query[1].indexOf("(")+1,query[1].lastIndexOf(")"))+"];})")};Class._paramQuery.proxy=function(){return Array.prototype.slice.call(arguments)};Class.paramsFrom=function(e){return{paramsFrom:e,map:[],to:function(e){this.map.push(typeof e=="object"?JSON.stringify(e):e);return this}}};Class.interface=function(){var e="";for(var t=0;t<arguments.length;t++){e+="this."+arguments[t]+'=function(){throw new Error("Interface method '+arguments[t]+'() is not implemented!")};\n'}Class._lastCreated=new Function(e);Class._lastCreated._methods=Array.prototype.slice.call(arguments);Class._lastCreated.check=Class.interface.check.bind(Class._lastCreated);Class._provideBasicFunctions(Class._lastCreated,true);return Class._lastCreated};Class.interface.check=function(e){var t={},n=new this;for(var r in this._methods)t[this._methods[r]]=n[this._methods[r]];for(var i=0;i<this._childClasses.length;i++){this._childClasses[i]._instance||(this._childClasses[i]._instance=new this._childClasses[i]);for(var s in t){if(this._childClasses[i]._instance[s].toString()==t[s].toString()){if(e)n[s]();return false}}}return true}