<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<title>js++ iterator demo</title>
	
	<style type="text/css">
		* {
			font-family: Calibri,Helvetia,sans-serif;
		}

		body {
			padding:5px 20px;
			margin:0;
		}
		
		pre {
			margin:0;
			padding:0;
		}
		
		pre span {
			padding: 5px;
			display: block;
		}

	</style>

	<script type="text/javascript" src="../js++.js"></script>
	<script type="text/javascript" src="../SJL/iterators.js"></script>
	<script type="text/javascript">

	_DEBUG = false;
	
	function debug(txt,toConsole)
	{
		document.getElementById('debug').innerHTML = document.getElementById('debug').innerHTML+'<span>'+(
				typeof(txt)!='string' ? 
					JSON.stringify(txt) : 
					txt.replace(/</g,'&lt;').replace(/>/g,'&gt;')
			)+'</span>';
		if(toConsole && console && typeof(console.info) == 'function')
			console.info(txt);
	}


	function loadTest()
	{
		var concatValues = function(i,s,carry){
			carry.result = carry.result ? carry.result+', '+i.current() : i.current();
		};

		var debugIteration = function(i){
			debug('\t'+i.key()+' : '+i.current());
		};

		// ArrayIterator test
		var array = [1,2,3],
		    ai = new ArrayIterator(array);
		debug('foreach <ArrayIterator> [1,2,3] : '+ai.foreach(concatValues).result);

		// Odd test
		debug('foreach <Odd(ArrayIterator)> [1,2,3] : '+Odd(ai).foreach(concatValues).result);
		
		// Even test
		array.push(4);
		debug('foreach <Even(ArrayIterator)> [1,2,3,4] : '+Even(ai).foreach(concatValues).result);

		// Reverse test
		debug('foreach <Reverse(ArrayIterator)> [1,2,3,4] : '+Reverse(ai).foreach(concatValues).result);
		
		// Reverse Odd test
		array.pop();
		debug('foreach <Odd(Reverse(ArrayIterator))> [1,2,3] : '+Odd(Reverse(ai)).foreach(concatValues).result);

		// full combo test (Infinite + Odd + Reverse)
		var concatInfinite = function(i,step,carry){
			if(step < 30)
				carry.result = carry.result ? carry.result+', '+i.current() : i.current();
			else
				return false // -> break
		};

		debug(
			'foreach <Infinite( Odd( Reverse( Iterator )))> [1,2,3,4,5] : '
			+ Infinite(Odd(Reverse(Iterator.for([1,2,3,4,5])))).foreach(concatInfinite).result
			+ ', ...'
		);


		// ObjectIterator test
		debug('foreach <ObjectIterator>: {a:1,b:2,c:3}');
		var object = {a:1,b:2,c:3},
		    oi = new ObjectIterator(object);

		Iterator.foreach(oi,debugIteration);


		// PropertyIterator test
		debug('foreach <PropertyIterator>: {a: function(){return 1}, b:2, c: function(){return 3}, d:4}');
		var object = {a:function(){return 1},b:2,c:function(){return 3},d:4},
		    pi = new PropertyIterator(object);

		pi.foreach(debugIteration);


		// MethodIterator test
		debug('foreach <MethodIterator>: {a: function(){return 1}, b:2, c: function(){return 3}, d:4}');
		var mi = new MethodIterator(object);

		mi.foreach(debugIteration);

		
		// DOM_Iterator test
		debug("spanIterator.foreach(function(i){\n\ti.current().style.borderBottom = '1px dotted #999';\n});");
		debug("Even(spanIterator).foreach(function(i){\n\ti.current().style.backgroundColor = '#eee';\n});");
		
		var spanIterator = new DOM_Iterator(document.getElementById('debug').firstElementChild);

		spanIterator.foreach(function(i){
			i.current().style.borderBottom = '1px dotted #999';
		});
		
		Even(spanIterator).foreach(function(i){
			i.current().style.backgroundColor = '#eee';
		});
		
		infinitum = Infinite(Odd(spanIterator));
		
		blink = function(){
			infinitum.current().style.paddingLeft = '';
			infinitum.next();
			if(infinitum.valid())
				infinitum.current().style.paddingLeft = '10px';
			blink.timer = window.setTimeout("blink()",50);
		};
	}
	</script>

</head>

<body onload="loadTest()">
	<pre id="debug"></pre>
	<button onclick="blink()">Infinite iterator effect</button><button onclick="window.clearTimeout(blink.timer)">stop</button>
	</pre>
</body>
</html>